# Powershell for Pentesters

## What is Powershell? 


- Powershell is a powerful built-in CLI or "shell" also task-oriented scripting language
- Mostly used by admins
- Built on top of .NET
- Scripts end with ".ps1"
- Version 5.0 onward introduce some hurdles regarding logging and restrictive modes
- Powershell 6.0 is available MacOS and Linux also as Docker image

## Fundamentals

```C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe``` where exe files of powershell stays.

For 64-bit it stays under system32 directory. 


```ps1
# You can learn like that
PS C:\Windows\system32\WindowsPowerShell\v1.0> [Environment]::Is64BitProcess
True 
```

You can learn detail with command below

```ps1
C:\> powershell /?
```


Execution Policy 

```ps1
powershell.exe -ExecutionPolicy Bypass ./shell.ps1
powershell.exe -ExecutionPolicy Unrestricted ./shell.ps1
powershell.exe -Command Get-Process
powershell.exe -Command "& {Get-Eventlog -Logname security}"
```

EncodedCommand: Used to executed base64 command

```ps1
powershell.exe -EncodedCommand $encodedCommand
```

- Like Man pages you can reach Get-Help section of all commands
  - ```Get-Help Get-Help```
  - ```Get-Help Get-Process -Full``` Gives full result regarding that command
  - ```Get-Help Get-Process -Examples``` you can learn examples of that commands You can updata man pages with Update-Help command
- You can learn commands by tunning the command so you don't need to memorize all. 


### Cmdlets

- You can change formats of command results
  - For ex. ```Get-Childitem | Format-List *```
- After learning all these commands you can pipe them to get objects
  - For ex. ```Get-Childitem | Sort-Object -Uniqe | Select-Object Basename```
- Redirection works as same like in other OS {<,>}
- You can use different format also
  - ```Get-Process notepad | Format-List Path```
  - or even ```Get-Process notepad | Format-List Path,Id,ProcessName```
- ```Get-WmiObject -class win32_operatingsystem | Select -Property *```
- We can use ```fl``` as alias to Format-List
- If you want you can create csv file you can use Export-Csv
  - ```Get-WmiObject -Class win32_service | Select-Object Name, ProcessID | export-csv C:\Users\public\Documents\try.csv```
  - In order to see Registry hives ```cd HKLM:\```
  - Select-String is important command
    - ```Select-String -Path C:\Users\public\Documents\*.txt -Pattern yoursearch*```
  - Get-Content
    - cat is same as Get-Content
  - To learn services which are running and available 
    - ```Get-Service```
    - ```Get-Service | Select-Object Name```
    - ```Get-Service "n*" | Sort-Object status -Descending```


